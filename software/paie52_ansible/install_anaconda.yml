---
- name: Set installation directory variable
  set_fact:
    install_dir: "{{ ansible_env.HOME }}/anaconda2"

- name: Check if anaconda2 directory already exists
  stat:
    path: "{{ install_dir }}"
  register: anaconda2_dir

- name: Set install args variable
  set_fact:
    args: ""

- name: If install directory exists use update arg
  set_fact:
    args: -u
  when: anaconda2_dir.stat.isdir is defined and anaconda2_dir.stat.isdir

- name: Get route to client
  command: "{{ hostvars['localhost']['python_executable_local'] }} \
  {{ hostvars['localhost']['scripts_path_local'] }}/python/ip_route_get_to.py \
  {{ inventory_hostname }}"
  delegate_to: localhost
  register: host_ip

- name: Download Anaconda
  get_url:
    owner: "{{ ansible_user_id }}"
    group: "{{ ansible_user_id }}"
    mode: 0744
    checksum: md5:e894dcc547a1c7d67deb04f6bba7223a
    url: "http://{{ host_ip.stdout }}/anaconda/Anaconda2-5.1.0-Linux-ppc64le.sh"
    dest: "{{ ansible_env.HOME }}"

- name: Install Anaconda
  shell: "{{ ansible_env.HOME }}/Anaconda2-5.1.0-Linux-ppc64le.sh \
          -b -p {{ install_dir }} {{ args }}"
  args:
    executable: /bin/bash

- name: Add Anaconda2 install location to PATH in bashrc
  lineinfile:
    path: "{{ ansible_env.HOME }}/.bashrc"
    regexp: ".*PATH={{ install_dir }}/bin.*"
    line: "export PATH={{ install_dir }}/bin:$PATH"
